(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(t,e,s){"use strict";function i(t){const e=new Array(t);return e.fill(0),e}function n(t){return t.slice()}function r(t,e){for(let s=0;s<t.length;s++)t[s]*=e}function o(t,e){if(t.length!==e.length)return void console.error("Vec.dot: mismatched vector lengths");let s=0;for(let i=0;i<t.length;i++)s+=t[i]*e[i];return s}function a(t){return Math.sqrt(o(t,t))}function h(t){const e=o(t,t);e>Number.EPSILON?r(t,1/Math.sqrt(e)):t.fill(0)}function c(t,e,s){const i=1-s**2,n=t.reduce((t,s,i)=>i===e?t:t+s**2,0);if(n>Number.EPSILON){r(t,Math.sqrt(i/n))}else{const e=Math.sqrt(i/(t.length-1));t.fill(-e)}t[e]=s}function l(t,e){if(t.length!==e.length)return void console.error("Vec.add: mismatched vector lengths");const s=n(t);for(let i=0;i<t.length;i++)s[i]+=e[i];return s}function u(t,e){if(t.length!==e.length)return void console.error("Vec.sub: mismatched vector lengths");const s=n(t);for(let i=0;i<t.length;i++)s[i]-=e[i];return s}function d(t,e,s,i){const o=n(e);r(o,t);const a=n(i);return r(a,s),l(o,a)}function f(t,e){const s=n(e);return r(s,o(t,e)),u(t,s)}function g(t,e,s,i){const n=Math.cos(i),r=Math.sin(i),o=t[e],a=t[s];t[e]=n*o-r*a,t[s]=r*o+n*a}s.r(e);const m=2e4,p=1e3*Number.EPSILON;class v{constructor(t){this.dims=t,this.resetBasis(),this.resetOffset()}resetBasis(){this.basis=[i(this.dims),i(this.dims)];const t=Math.sqrt(2/this.dims),e=(this.dims%2+1)*Math.PI/this.dims;for(let s=0;s<this.dims;s++)this.basis[0][s]=t*Math.cos(e*s),this.basis[1][s]=t*Math.sin(e*s)}basisTest(){console.debug("--------------------"),console.debug("|u| =",a(this.basis[0])),console.debug("|v| =",a(this.basis[1])),console.debug("u . v =",o(this.basis[0],this.basis[1]))}resetOffset(){const t=5===this.dims?.3:0;this.offset=new Array(this.dims),this.offset.fill(t)}project(t){return function(t,e){const s=i(e.length);for(let i=0;i<e.length;i++)s[i]=o(t,e[i]);return s}(u(t,this.offset),this.basis)}unproject(t){return l(d(t[0],this.basis[0],t[1],this.basis[1]),this.offset)}translateOffset(t,e){this.offset=this.unproject([t,e]).map(t=>t-Math.floor(t))}moveAxis(t,e,s){let i=e,n=s,r=Math.hypot(e,s);r<=Number.EPSILON?(i=1,n=0,r=0):(i/=r,n/=r,r=Math.min(r,1));let o=this.basis[0],a=this.basis[1];const h=d(i,o,n,a),l=d(-n,o,i,a);o=h,c(a=l,t,0),c(o=f(o,a),t,r),this.basis[0]=d(i,o,-n,a),this.basis[1]=d(n,o,i,a)}validate(){h(this.basis[0]),this.basis[1]=f(this.basis[1],this.basis[0]),h(this.basis[1]),0!==a(this.basis[0])&&0!==a(this.basis[1])||this.resetBasis();for(let t=0;t<this.dims;t++)this.offset[t]=Math.max(0,Math.min(1,this.offset[t]))}}class y{constructor(t,e){this.state=t,this.checkAxes=e,this.cache=new Map}makeVertex(t){return{coord:t,pcoord:this.state.project(t),inCut:this.checkAxes.cutCheck(t),seen:!1}}get(t){const e=t.toString();let s=this.cache.get(e);return s||(s=this.makeVertex(t),this.cache.set(e,s)),s}getNeighbor(t,e,s){const i=n(t.coord);return i[e]+=s,this.get(i)}}function b(t,e,s){const i=new w(t),n=new y(t,i),r=[],o=1.5+e/2,a=1.5+s/2,h=[n.get(t.offset.map(Math.floor))];for(let e=0;e<t.dims;e++)h.push(...h.map(t=>n.getNeighbor(t,e,1)));const c=h.filter(t=>t.inCut);for(;c.length>0&&r.length<m;){const e=c.pop();if(!e.seen&&(e.seen=!0,!(!e.inCut||Math.abs(e.pcoord[0])>o||Math.abs(e.pcoord[1])>a))){r.push(e);for(let s=0;s<t.dims;s++)for(let t of[-1,1]){const i=n.getNeighbor(e,s,t);i.seen||c.push(i)}}}const l=[],u=k(t.dims);return r.forEach(e=>{for(let s=0;s<t.dims;s++){const i=n.getNeighbor(e,s,1);if(i.inCut)for(let r=s+1;r<t.dims;r++){const t=n.getNeighbor(e,r,1),o=n.getNeighbor(i,r,1);t.inCut&&o.inCut&&l.push({verts:[e.pcoord,i.pcoord,o.pcoord,t.pcoord],type:u[s][r]})}}}),l}class w{constructor(t){this.checkAxes=[];for(let e=0;e<t.dims-2;e++)for(let s=e+1;s<t.dims-1;s++)for(let n=s+1;n<t.dims;n++){const r=i(t.dims);r[e]=t.basis[0][n]*t.basis[1][s]-t.basis[0][s]*t.basis[1][n],r[s]=t.basis[0][e]*t.basis[1][n]-t.basis[0][n]*t.basis[1][e],r[n]=t.basis[0][s]*t.basis[1][e]-t.basis[0][e]*t.basis[1][s],Math.abs(r[e])<=Number.EPSILON&&(r[e]=0),Math.abs(r[s])<=Number.EPSILON&&(r[s]=0),Math.abs(r[n])<=Number.EPSILON&&(r[n]=0),h(r),0!==a(r)&&this.checkAxes.push(r)}const e=function(t){const e=[],s=i(t),r=function(t){t>0?(s[t-1]=.5,r(t-1),s[t-1]=-.5,r(t-1)):e.push(n(s))};return r(t),e}(t.dims).map(e=>l(e,t.offset));this.checkMax=[],this.checkMin=[],this.checkAxes.forEach(t=>{let s=-1/0,i=1/0;e.forEach(e=>{const n=o(e,t);s=Math.max(s,n),i=Math.min(i,n)}),this.checkMax.push(s),this.checkMin.push(i)})}cutCheck(t){return this.checkAxes.every((e,s)=>{const i=o(t,e);return i-this.checkMin[s]>p&&this.checkMax[s]-i>=-p})}cutStatus(t){return this.checkAxes.map((e,s)=>{const i=o(t,e);return Math.abs(this.checkMax[s]-i)<=p?"+":Math.abs(i-this.checkMin[s])<=p?"-":this.checkMin[s]<i&&i<this.checkMax[s]?"=":"_"}).join("")}}function k(t){const e=[];for(let s=0;s<t;s++)e.push([]);let s=0;for(let i=0;i<t-1;i++)for(let n=i+1;n<t;n++)e[i][n]=s,e[n][i]=s,s+=1;return e}function x(t,e,s){const i=[];for(let e=0;e<t.dims;e++)i.push([t.basis[0][e],t.basis[1][e]]);const n=function(t){const e=[];for(let s=0;s<t.length;s++){e.push([]);for(let i=0;i<=s;i++)s===i?e[s][s]=0:(e[s][i]=t[s][0]*t[i][1]-t[i][0]*t[s][1],e[i][s]=-e[s][i])}return e}(i),r=e/2+Math.SQRT1_2,o=s/2+Math.SQRT1_2,a=function(t,e,s){const i=[t.unproject([-e,-s]),t.unproject([-e,s]),t.unproject([e,-s]),t.unproject([e,s])],n=[],r=[];for(let e=0;e<t.dims;e++)n.push(i.reduce((t,s)=>Math.min(t,Math.floor(s[e])),1/0)),r.push(i.reduce((t,s)=>Math.max(t,Math.ceil(s[e])),-1/0));return{min:n,max:r}}(t,r,o),h=k(t.dims),c=[];for(let e=0;e<t.dims-1;e++)for(let s=e+1;s<t.dims;s++)if(!(Math.abs(n[e][s])<Number.EPSILON))for(let u=a.min[e];u<a.max[e];u++)for(let d=a.min[s];d<a.max[s];d++){const a=M(e,s,u,d,t,i,n),f=t.project(a),g=f[0]+(i[e][0]+i[s][0])/2,m=f[1]+(i[e][1]+i[s][1])/2;if(Math.abs(g)>r||Math.abs(m)>o)continue;const p=l(f,i[e]),v=l(p,i[s]),y=l(f,i[s]);c.push({verts:[f,p,v,y],a1:e,a2:s,type:h[e][s]})}return c}function M(t,e,s,i,n,r,a){const h=s+.5-n.offset[t],c=i+.5-n.offset[e],l=(h*r[e][1]-c*r[t][1])/a[t][e],u=(c*r[t][0]-h*r[e][0])/a[t][e];return n.unproject([l,u]).map((n,h)=>{if(h===t)return s;if(h===e)return i;if(Math.abs(n-Math.floor(n)-.5)<1e-10){if(Math.abs(a[t][h])<Number.EPSILON){if(o(r[h],r[t])>0&&h<t)return Math.ceil(n)}else if(Math.abs(a[h][e])<Number.EPSILON){if(o(r[h],r[e])>0&&h<e)return Math.ceil(n)}else if(a[t][e]*a[t][h]>0&&a[t][e]*a[h][e]>0)return Math.ceil(n);return Math.floor(n)}return Math.round(n)})}function E(t){return Math.max(0,Math.min(255,Math.floor(t))).toString(16).padStart(2,"0")}function C(t,e){return function(t,e,s){return`#${E(t)}${E(e)}${E(s)}`}(t.getUint8(e),t.getUint8(e+1),t.getUint8(e+2))}function A(t){return[Number.parseInt(t.slice(1,3),16),Number.parseInt(t.slice(3,5),16),Number.parseInt(t.slice(5,7),16)]}const L=60,S=30,B=290,O=2/L,_="#000000";class I extends v{constructor(t){super(t),this.initColors(t),this.lineColor=_}initColors(t){if(3===t)return void(this.colors=["#808080","#e8e8ff","#c0c0c0"]);const e={4:["#e8e8ff","#808080","#e8e8ff"],5:["#e8e8ff","#808080","#808080","#e8e8ff"],6:["#808080","#c0c0c0","#e8e8ff","#c0c0c0","#808080"],7:["#c0c0c0","#e8e8ff","#808080","#808080","#e8e8ff","#c0c0c0"]}[t];this.colors=[];for(let s=0;s<t-1;s++)for(let i=0;i<t-s-1;i++)this.colors.push(e?e[i]:"#ffffff")}genStateCode(t){const e=function(t){const e=2*t.dims,s=t.dims,i=t.colors,n=3*(1+i.length),r=new ArrayBuffer(2+2*e+s+n),o=new DataView(r);o.setUint8(0,1),o.setUint8(1,t.dims);let a=2;return t.basis.forEach(t=>t.forEach(t=>{o.setInt16(a,Math.round(32767*t)),a+=2})),t.offset.forEach(t=>{o.setUint8(a,Math.round(200*t)),a+=1}),A(t.lineColor).forEach((t,e)=>o.setUint8(a+e,t)),a+=3,i.forEach(t=>{A(t).forEach((t,e)=>o.setUint8(a+e,t)),a+=3}),new Blob([r])}(this),s=new FileReader;s.addEventListener("loadend",()=>{const e=s.result.split(",")[1];console.log("generated state code:",e),t(e)},!1),s.readAsDataURL(e)}}function N(t,e){const s=function(t){const e=atob(t),s=new Uint8Array(e.length);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return new Blob([s])}(t),i=new FileReader;i.addEventListener("loadend",()=>{const t=function(t){try{const e=new DataView(t);if(1!==e.getUint8(0))return console.error("Tiling state decode: invalid format"),null;const s=e.getUint8(1);if(s<3||s>7)return console.error("Tiling state decode: unsupported dimension"),null;let i=2;const n=[];for(let t=0;t<2;t++){const t=[];for(let n=0;n<s;n++)t.push(e.getInt16(i)/32767),i+=2;n.push(t)}const r=[];for(let t=0;t<s;t++)r.push(e.getUint8(i)/200),i+=1;const o=C(e,i);i+=3;const a=[];for(let t=0;t<s*(s-1)/2;t++)a.push(C(e,i)),i+=3;return{dims:s,basis:n,offset:r,lineColor:o,colors:a}}catch(t){if(t instanceof RangeError)return console.error("Tiling state decode: invalid state code (RangeError)"),null;throw t}}(i.result);if(t){const s=new I(t.dims);s.basis=t.basis,s.offset=t.offset,s.colors=t.colors,s.lineColor=t.lineColor,s.validate(),e(s)}else console.error("Failed decoding state code.")},!1),i.readAsArrayBuffer(s)}class T{constructor(t,e){this.canvas=t,this.app=e,this.tracking=null,this.scale=L,t.width=t.clientWidth,t.height=t.clientHeight,this.calcViewSize(),t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1),t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1),t.addEventListener("wheel",this,{passive:!0}),window.addEventListener("resize",this,!1)}draw(t,e){const s=e(t,this.viewWidth,this.viewHeight),i=this.canvas.getContext("2d");i.clearRect(0,0,i.canvas.width,i.canvas.height),i.save(),i.translate(i.canvas.width/2,i.canvas.height/2),i.scale(this.scale,this.scale),i.lineWidth=O,i.lineJoin="bevel",i.strokeStyle=t.lineColor,s.forEach(e=>{i.fillStyle=t.colors[e.type],i.beginPath(),i.moveTo(e.verts[0][0],e.verts[0][1]),i.lineTo(e.verts[1][0],e.verts[1][1]),i.lineTo(e.verts[2][0],e.verts[2][1]),i.lineTo(e.verts[3][0],e.verts[3][1]),i.closePath(),i.fill(),i.stroke()}),i.restore()}handleEvent(t){switch(t.type){case"mousedown":this.tracking={x:t.offsetX,y:t.offsetY};break;case"mousemove":this.tracking&&this.mouseMove(t.offsetX,t.offsetY);break;case"mouseup":this.tracking=null;break;case"touchstart":this.touchStart(t);break;case"touchmove":this.touchMove(t);break;case"touchend":this.tracking=null;break;case"wheel":this.wheelMove(t);break;case"resize":this.resize()}}mouseMove(t,e){this.viewMove(this.tracking.x-t,this.tracking.y-e),this.tracking.x=t,this.tracking.y=e}wheelMove(t){this.viewZoom(t.deltaY>0?.8:1.25)}touchStart(t){t.preventDefault(),this.tracking||(this.tracking=[]);for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];if(this.tracking.touch0){if(this.tracking.touch1)break;this.tracking.touch1={id:s.identifier,x:s.pageX,y:s.pageY},this.tracking.dist=Math.hypot(this.tracking.touch0.x-this.tracking.touch1.x,this.tracking.touch0.y-this.tracking.touch1.y)}else this.tracking.touch0={id:s.identifier,x:s.pageX,y:s.pageY}}}touchMove(t){if(this.tracking){t.preventDefault();let e=!1;for(let s=0;s<t.changedTouches.length;s++){const i=t.changedTouches[s];this.tracking.touch0.id===i.identifier?(this.tracking.touch0.lastX=this.tracking.touch0.x,this.tracking.touch0.lastY=this.tracking.touch0.y,this.tracking.touch0.x=i.pageX,this.tracking.touch0.y=i.pageY,e=!0):this.tracking.touch1.id===i.identifier&&(this.tracking.touch1.x=i.pageX,this.tracking.touch1.y=i.pageY,e=!0)}if(e)if(this.tracking.touch1){const t=Math.hypot(this.tracking.touch0.x-this.tracking.touch1.x,this.tracking.touch0.y-this.tracking.touch1.y);0!==this.tracking.dist&&this.viewZoom(t/this.tracking.dist),this.tracking.dist=t}else this.viewMove(this.tracking.touch0.lastX-this.tracking.touch0.x,this.tracking.touch0.lastY-this.tracking.touch0.y)}}viewMove(t,e){this.app.translateOffset(t/this.scale,e/this.scale)}calcViewSize(){this.viewWidth=this.canvas.width/this.scale,this.viewHeight=this.canvas.height/this.scale}viewZoom(t){const e=this.scale;t>1?this.scale=Math.min(B,Math.ceil(this.scale*t)):t<1&&(this.scale=Math.max(S,Math.floor(this.scale*t))),this.scale!==e&&(this.calcViewSize(),this.app.redraw())}resize(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.calcViewSize(),this.app.redraw()}}const P=60,j=4/P,U=(8/P)**2;class R{constructor(t,e){this.x=t,this.y=e}draw(t){t.beginPath(),t.arc(this.x,this.y,j,0,2*Math.PI),t.fill()}contains(t,e){const s=t-this.x,i=e-this.y;return s*s+i*i<U}valueChanged(){}mouseAction(t,e){this.x=t,this.y=e,this.valueChanged()}}class D{constructor(t,e,s){this.canvas=t,this.app=e,this.tracking=null,t.width=t.clientWidth,t.height=t.clientHeight,t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1),t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1),this.setNumAxes(s)}setNumAxes(t){this.ctls=[];for(let e=0;e<t;e++){const t=new R(0,0);t.valueChanged=(()=>{this.app.axisChanged(e,t.x,t.y)}),this.ctls.push(t)}}draw(){const t=this.canvas.getContext("2d");t.save(),t.fillStyle="white",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.translate(this.canvas.width/2,this.canvas.height/2),t.scale(P,P),t.lineWidth=1/P,t.strokeStyle="lightgrey",t.beginPath(),t.arc(0,0,Math.sqrt(2/this.ctls.length),0,2*Math.PI),t.stroke(),t.strokeStyle="grey",t.beginPath(),t.arc(0,0,1,0,2*Math.PI),t.stroke(),t.strokeStyle="black",t.beginPath();for(let e=0;e<this.ctls.length;e++){t.moveTo(0,0),t.lineTo(this.ctls[e].x,this.ctls[e].y);const s=(e+1)%this.ctls.length;t.lineTo(this.ctls[e].x+this.ctls[s].x,this.ctls[e].y+this.ctls[s].y),t.lineTo(this.ctls[s].x,this.ctls[s].y)}t.stroke(),t.fillStyle="black",this.ctls.forEach(e=>{e.draw(t)}),t.restore()}handleEvent(t){switch(t.type){case"mousedown":this.mouseDown(t);break;case"mousemove":this.mouseMove(t);break;case"mouseup":this.tracking=null;break;case"touchstart":this.touchStart(t);break;case"touchmove":this.touchMove(t);break;case"touchend":this.tracking=null}}toLocalPos(t,e){return{x:(t-this.canvas.width/2)/P,y:(e-this.canvas.height/2)/P}}findControl(t,e){const s=this.toLocalPos(t,e);return this.ctls.find(t=>t.contains(s.x,s.y))}mouseAction(t,e,s){const i=this.toLocalPos(e,s);t.mouseAction(i.x,i.y)}mouseDown(t){this.tracking=this.findControl(t.offsetX,t.offsetY)}mouseMove(t){this.tracking&&this.mouseAction(this.tracking,t.offsetX,t.offsetY)}touchStart(t){if(!this.tracking){const e=t.changedTouches[0],s=V(e),i=this.findControl(s.x,s.y);i&&(t.preventDefault(),this.tracking={target:i,identifier:e.identifier})}}touchMove(t){if(this.tracking){t.preventDefault();const e=function(t,e){for(let s=0;s<t.length;s++)if(t[s].identifier===e)return t[s];return null}(t.changedTouches,this.tracking.identifier);if(e){const t=V(e);this.mouseAction(this.tracking.target,t.x,t.y)}}}}function V(t){const e=t.target.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}class z{constructor(t,e,s){this.div=t,this.app=e,this.ctls=[],this.lbls=[],this.setNumAxes(s)}addOffset(){const t=document.createElement("div");this.div.append(t);const e=this.ctls.length,s=document.createElement("input");s.type="range",s.min=0,s.max=1,s.step=.01,this.ctls.push(s),t.append(s);const i=document.createElement("span");i.className="offset-label",this.lbls.push(i),t.append(i),s.addEventListener("input",t=>{i.innerHTML=s.valueAsNumber.toFixed(2),this.app.offsetChanged(e,s.valueAsNumber)})}removeOffset(){this.div.removeChild(this.div.lastChild),this.ctls.pop(),this.lbls.pop()}setNumAxes(t){for(;this.ctls.length>t;)this.removeOffset();for(;this.ctls.length<t;)this.addOffset()}setOffset(t,e){this.ctls[t].valueAsNumber=e,this.lbls[t].innerHTML=e.toFixed(2)}}var Y=s(2);function X(t,e,s){const i=Y.b(t.dims,t.basis[0],t.basis[1],t.offset,e,s),n=[],r=i.get_num_faces();for(let t=0;t<r;t++){const e=i.get_face(t);n.push({verts:[[e.vert0x,e.vert0y],[e.vert1x,e.vert1y],[e.vert2x,e.vert2y],[e.vert3x,e.vert3y]],type:e.face_type}),e.free()}return i.free(),n}class q{constructor(){const t=document.getElementById("numAxes");t.addEventListener("change",()=>{this.setState(new I(parseInt(t.value,10)))});const e=parseInt(t.value,10);this.state=new I(e);const s=document.getElementById("main");this.tilingView=new T(s,this);const i=document.getElementById("tileGen");i.addEventListener("change",()=>{this.tilingGen=this.getTilingGen(i.value)}),this.tilingGen=this.getTilingGen(i.value);const n=document.getElementById("axisRosette");this.axisControls=new D(n,this,e),this.updateAxisControls(),F("axisToggle","axisControls");const r=document.getElementById("offsetControls");this.offsetControls=new z(r,this,e),this.updateOffsetControls(),F("offsetToggle","offsetControls"),document.getElementById("offsetControls").style.display="none",document.getElementById("reset").addEventListener("click",()=>{this.state.resetBasis(),this.updateAxisControls(),this.redraw()}),this.initColorControls(e),F("colorToggle","colorControls"),document.getElementById("colorControls").style.display="none",F("aboutToggle","about"),document.getElementById("about").style.display="none",this.animating=!1,this.animTime=-1;const o=document.getElementById("animate");o.addEventListener("click",()=>{this.animating?(this.stopAnimation(),o.value="Animate"):(this.startAnimation(),o.value="Stop animation")}),document.getElementById("save").addEventListener("click",()=>{this.state.genStateCode(t=>{const e=document.getElementById("codeCode");e.innerHTML=t,window.getSelection().selectAllChildren(e),document.getElementById("codeLink").href="?a="+t,document.getElementById("codeShow").classList.add("codeActive")})}),document.getElementById("codeDone").addEventListener("click",()=>{document.getElementById("codeShow").classList.remove("codeActive")});const a=document.getElementById("codeInput");a.addEventListener("change",()=>{console.log("loading state code:",a.value),a.blur(),N(a.value,t=>this.setState(t))}),a.addEventListener("blur",()=>{document.getElementById("codeLoad").classList.remove("codeActive")}),document.getElementById("load").addEventListener("click",()=>{a.value="",a.focus(),document.getElementById("codeLoad").classList.add("codeActive")}),this.draw(),this.needsRedraw=!1}getTilingGen(t){return"project"===t?b:"multigrid"===t?x:"wasm"==t?X:(console.error("unknown tiling generator type:",t),x)}initColorControls(t){const e=document.getElementById("controls").clientWidth,s=`${Math.floor(e/(t-1))}px`,i=document.getElementById("colorControls");let n=0;for(let e=0;e<t-1;e++){let r=document.createElement("div");i.append(r);for(let i=0;i<t-e-1;i++){const t=n++,e=document.createElement("input");e.type="color",e.value=this.state.colors[t],e.style.width=s,e.addEventListener("input",()=>{this.state.colors[t]=e.value,this.redraw()}),r.prepend(e)}}}removeColorControls(){const t=document.getElementById("colorControls"),e=t.cloneNode(!1);t.parentNode.replaceChild(e,t)}draw(){this.tilingView.draw(this.state,this.tilingGen),this.axisControls.draw()}redraw(){this.needsRedraw||(this.needsRedraw=!0,window.requestAnimationFrame(()=>{this.needsRedraw=!1,this.draw()}))}updateAxisControls(){this.axisControls.ctls.forEach((t,e)=>{t.x=this.state.basis[0][e],t.y=this.state.basis[1][e]})}axisChanged(t,e,s){this.state.moveAxis(t,e,s),this.updateAxisControls(),this.redraw()}updateOffsetControls(){this.state.offset.forEach((t,e)=>{this.offsetControls.setOffset(e,t)})}offsetChanged(t,e){this.state.offset[t]=e,this.redraw()}translateOffset(t,e){this.state.translateOffset(t,e),this.updateOffsetControls(),this.redraw()}setState(t){this.state=t,document.getElementById("numAxes").value=this.state.dims,this.axisControls.setNumAxes(this.state.dims),this.updateAxisControls(),this.offsetControls.setNumAxes(this.state.dims),this.updateOffsetControls(),this.removeColorControls(),this.initColorControls(this.state.dims),this.redraw()}startAnimation(){this.animating=!0,this.animTime=-1,window.requestAnimationFrame(t=>this.animate(t))}stopAnimation(){this.animating=!1}animate(t){if(!this.animating)return;const e=this.animTime>=0?t-this.animTime:0;this.animTime=t;const s=2*Math.PI/3e4*e;g(this.state.basis[0],0,1,s),g(this.state.basis[1],0,1,s),this.updateAxisControls(),this.draw(),window.requestAnimationFrame(t=>this.animate(t))}}function F(t,e){const s=document.getElementById(t);s.addEventListener("click",()=>{s.classList.toggle("active");const t=document.getElementById(e);"none"===t.style.display?t.style.display="block":t.style.display="none"})}function H(){const t=new q,e=new URLSearchParams(document.location.search);if(e.has("a")){const s=e.get("a").replace(/ /g,"+");console.log("initialising from state code:",s),N(s,e=>t.setState(e))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>H):H()},function(t,e,s){"use strict";(function(t){s.d(e,"b",function(){return a}),s.d(e,"a",function(){return f});var i=s(4);let n=null;let r=0;function o(t){const e=i.v(8*t.length);return(null!==n&&n.buffer===i.z.buffer||(n=new Float64Array(i.z.buffer)),n).set(t,e/8),r=t.length,e}function a(t,e,s,n,a,c){const l=o(e),u=r,d=o(s),f=r,g=o(n),m=r;try{return h.__wrap(i.y(t,l,u,d,f,g,m,a,c))}finally{i.u(l,8*u),i.u(d,8*f),i.u(g,8*m)}}class h{static __wrap(t){const e=Object.create(h.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,function(t){i.b(t)}(t)}get_num_faces(){return i.x(this.ptr)}get_face(t){return c.__wrap(i.w(this.ptr,t))}}class c{static __wrap(t){const e=Object.create(c.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,function(t){i.a(t)}(t)}get vert0x(){return i.d(this.ptr)}set vert0x(t){return i.m(this.ptr,t)}get vert0y(){return i.e(this.ptr)}set vert0y(t){return i.n(this.ptr,t)}get vert1x(){return i.f(this.ptr)}set vert1x(t){return i.o(this.ptr,t)}get vert1y(){return i.g(this.ptr)}set vert1y(t){return i.p(this.ptr,t)}get vert2x(){return i.h(this.ptr)}set vert2x(t){return i.q(this.ptr,t)}get vert2y(){return i.i(this.ptr)}set vert2y(t){return i.r(this.ptr,t)}get vert3x(){return i.j(this.ptr)}set vert3x(t){return i.s(this.ptr,t)}get vert3y(){return i.k(this.ptr)}set vert3y(t){return i.t(this.ptr,t)}get face_type(){return i.c(this.ptr)}set face_type(t){return i.l(this.ptr,t)}}let l=new t("utf-8"),u=null;function d(t,e){return l.decode((null!==u&&u.buffer===i.z.buffer||(u=new Uint8Array(i.z.buffer)),u).subarray(t,t+e))}function f(t,e){throw new Error(d(t,e))}}).call(this,s(3).TextDecoder)},function(t,e,s){"use strict";function i(t,e,s){return e<=t&&t<=s}function n(t){if(void 0===t)return{};if(t===Object(t))return t;throw TypeError("Could not convert argument to dictionary")}s.r(e),s.d(e,"TextEncoder",function(){return u}),s.d(e,"TextDecoder",function(){return l});var r=-1;function o(t){this.tokens=[].slice.call(t)}o.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():r},prepend:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(t)},push:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.push(e.shift());else this.tokens.push(t)}};var a=-1;function h(t,e){if(t)throw TypeError("Decoder error");return e||65533}var c="utf-8";function l(t,e){if(!(this instanceof l))return new l(t,e);if((t=void 0!==t?String(t).toLowerCase():c)!==c)throw new Error("Encoding not supported. Only utf-8 is supported");e=n(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(e.fatal),this._ignoreBOM=Boolean(e.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function u(t,e){if(!(this instanceof u))return new u(t,e);if((t=void 0!==t?String(t).toLowerCase():c)!==c)throw new Error("Encoding not supported. Only utf-8 is supported");e=n(e),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(e.fatal)},Object.defineProperty(this,"encoding",{value:"utf-8"})}function d(t){var e=t.fatal,s=0,n=0,o=0,c=128,l=191;this.handler=function(t,u){if(u===r&&0!==o)return o=0,h(e);if(u===r)return a;if(0===o){if(i(u,0,127))return u;if(i(u,194,223))o=1,s=u-192;else if(i(u,224,239))224===u&&(c=160),237===u&&(l=159),o=2,s=u-224;else{if(!i(u,240,244))return h(e);240===u&&(c=144),244===u&&(l=143),o=3,s=u-240}return s<<=6*o,null}if(!i(u,c,l))return s=o=n=0,c=128,l=191,t.prepend(u),h(e);if(c=128,l=191,s+=u-128<<6*(o-(n+=1)),n!==o)return null;var d=s;return s=o=n=0,d}}function f(t){t.fatal;this.handler=function(t,e){if(e===r)return a;if(i(e,0,127))return e;var s,n;i(e,128,2047)?(s=1,n=192):i(e,2048,65535)?(s=2,n=224):i(e,65536,1114111)&&(s=3,n=240);for(var o=[(e>>6*s)+n];s>0;){var h=e>>6*(s-1);o.push(128|63&h),s-=1}return o}}l.prototype={decode:function(t,e){var s;s="object"==typeof t&&t instanceof ArrayBuffer?new Uint8Array(t):"object"==typeof t&&"buffer"in t&&t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(0),e=n(e),this._streaming||(this._decoder=new d({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(e.stream);for(var i,r=new o(s),h=[];!r.endOfStream()&&(i=this._decoder.handler(r,r.read()))!==a;)null!==i&&(Array.isArray(i)?h.push.apply(h,i):h.push(i));if(!this._streaming){do{if((i=this._decoder.handler(r,r.read()))===a)break;null!==i&&(Array.isArray(i)?h.push.apply(h,i):h.push(i))}while(!r.endOfStream());this._decoder=null}return h.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===h[0]?(this._BOMseen=!0,h.shift()):this._BOMseen=!0)),function(t){for(var e="",s=0;s<t.length;++s){var i=t[s];i<=65535?e+=String.fromCharCode(i):(i-=65536,e+=String.fromCharCode(55296+(i>>10),56320+(1023&i)))}return e}(h)}},u.prototype={encode:function(t,e){t=t?String(t):"",e=n(e),this._streaming||(this._encoder=new f(this._options)),this._streaming=Boolean(e.stream);for(var s,i=[],r=new o(function(t){for(var e=String(t),s=e.length,i=0,n=[];i<s;){var r=e.charCodeAt(i);if(r<55296||r>57343)n.push(r);else if(56320<=r&&r<=57343)n.push(65533);else if(55296<=r&&r<=56319)if(i===s-1)n.push(65533);else{var o=t.charCodeAt(i+1);if(56320<=o&&o<=57343){var a=1023&r,h=1023&o;n.push(65536+(a<<10)+h),i+=1}else n.push(65533)}i+=1}return n}(t));!r.endOfStream()&&(s=this._encoder.handler(r,r.read()))!==a;)Array.isArray(s)?i.push.apply(i,s):i.push(s);if(!this._streaming){for(;(s=this._encoder.handler(r,r.read()))!==a;)Array.isArray(s)?i.push.apply(i,s):i.push(s);this._encoder=null}return new Uint8Array(i)}}},function(t,e,s){"use strict";var i=s.w[t.i];t.exports=i;s(2);i.A()}]]);